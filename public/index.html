<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Descarga videos de YouTube, TikTok, Instagram y Twitter con opciones de calidad, extracci√≥n de audio y recortes personalizados">
    <title>Videownload | Descarga videos de YouTube, TikTok, Instagram y Twitter</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Fondo animado -->
    <div class="background-effects">
        <div class="gradient-orb orb-1"></div>
        <div class="gradient-orb orb-2"></div>
        <div class="gradient-orb orb-3"></div>
        <div class="noise-overlay"></div>
    </div>

    <main class="container">
        <!-- Header compacto -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </div>
                <span class="logo-text">Videownload</span>
            </div>

            <button id="openHistoryBtn" class="header-icon-btn" title="Historial">
                <svg viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                    <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
            </button>

            <!-- Selector de Carpeta (solo visible en Electron) -->
            <div id="folderPickerSection" class="folder-picker-section" style="display: none;">
                <div class="folder-status" id="folderStatus">
                    <div class="folder-status-icon" id="folderStatusIcon">
                        <svg viewBox="0 0 24 24" fill="none">
                            <path
                                d="M22 19C22 20.1046 21.1046 21 20 21H4C2.89543 21 2 20.1046 2 19V5C2 3.89543 2.89543 3 4 3H9L11 6H20C21.1046 6 22 6.89543 22 8V19Z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                    <div class="folder-status-text">
                        <span class="folder-status-label" id="folderStatusLabel">Carpeta de descarga</span>
                        <span class="folder-status-value" id="folderStatusValue">Sin configurar</span>
                    </div>
                </div>
                <div class="folder-buttons">
                    <button id="openFolderBtn" class="folder-open-btn" title="Abrir carpeta">
                        <svg viewBox="0 0 24 24" fill="none" width="16" height="16">
                            <path d="M18 13V19C18 20.1 17.1 21 16 21H5C3.9 21 3 20.1 3 19V8C3 6.9 3.9 6 5 6H11"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M15 3H21V9" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <path d="M10 14L21 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </button>
                    <button id="folderPickerBtn" class="folder-picker-btn">
                        <span id="folderBtnText">Cambiar</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Layout de dos columnas -->
        <div class="main-layout">

            <!-- Panel Principal (IZQUIERDA) - Cola de Descargas -->
            <div class="queue-panel-primary">
                <!-- Input siempre visible arriba -->
                <div class="top-input-section">
                    <div class="input-wrapper compact">
                        <span class="input-icon">üîó</span>
                        <input type="text" id="urlInput" class="url-input" placeholder="Pega un link de video..."
                            autocomplete="off">
                        <button id="fetchBtn" class="fetch-btn">
                            <svg class="fetch-icon" viewBox="0 0 24 24" fill="none">
                                <path d="M5 12H19M19 12L13 6M19 12L13 18" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                    </div>
                    <div id="errorMessage" class="error-message"></div>
                </div>

                <div class="queue-header-primary">
                    <h3>
                        <svg viewBox="0 0 24 24" fill="none">
                            <path d="M4 6H20M4 12H20M4 18H12" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        Cola de Descargas (<span id="queueCount">0</span>)
                    </h3>
                    <!-- Acciones de cola -->
                    <div class="queue-actions">
                        <button id="downloadSelectedBtn" class="download-selected-btn hidden"
                            title="Descargar videos seleccionados">
                            <svg viewBox="0 0 24 24" fill="none">
                                <path d="M9 11L12 14L22 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path
                                    d="M21 12V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V5C3 3.89543 3.89543 3 5 3H16"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            </svg>
                            Descargar Seleccionados (<span id="selectedCount">0</span>)
                        </button>
                        <button id="downloadAllBtn" class="download-all-btn" title="Descargar todos los videos">
                            <svg viewBox="0 0 24 24" fill="none">
                                <path d="M21 15V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V15"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                                <path d="M12 3V15M12 15L7 10M12 15L17 10" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            Descargar Todo
                        </button>
                        <button id="clearQueueBtn" class="queue-action-btn" title="Limpiar todo">
                            <svg viewBox="0 0 24 24" fill="none">
                                <path
                                    d="M19 7L18.1327 19.1425C18.0579 20.1891 17.187 21 16.1378 21H7.86224C6.81296 21 5.94208 20.1891 5.86732 19.1425L5 7M10 11V17M14 11V17M15 7V4C15 3.44772 14.5523 3 14 3H10C9.44772 3 9 3.44772 9 4V7M4 7H20"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div id="queueSection" class="queue-content-primary">
                    <div id="queueList" class="queue-list-grid">
                        <!-- Items de la cola se muestran aqu√≠ -->
                        <div id="emptyState" class="empty-state-minimal">
                            <div class="empty-hint">
                                <span class="hint-icon">üìã</span>
                                <span class="hint-text">Copia links para agregarlos a la cola</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Indicador de progreso de batch -->
                <div id="batchProgress" class="batch-progress hidden">
                    <div class="batch-progress-icon">
                        <svg viewBox="0 0 24 24" fill="none">
                            <path d="M21 15V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V15"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            <path d="M12 3V15M12 15L7 10M12 15L17 10" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                    <span class="batch-progress-text">Descargando <strong id="batchCurrent">0</strong> de <strong
                            id="batchTotal">0</strong></span>
                </div>

                <!-- Barra de progreso GLOBAL (movida aqu√≠) -->
                <div id="progressContainer" class="progress-container hidden">
                    <div class="progress-info">
                        <span id="statusText">Preparando descarga...</span>
                        <span id="progressText">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
            </div>

            <!-- Panel Lateral (DERECHA) - Preview y Controles -->
            <div class="controls-panel-sidebar">

                <!-- Preview del video -->
                <section id="videoPreview" class="video-preview-sidebar hidden">
                    <div class="preview-card-sidebar">
                        <div class="thumbnail-container-sidebar">
                            <img id="thumbnail" src="" alt="Video thumbnail">
                            <div class="duration-badge" id="durationBadge">0:00</div>
                            <div class="platform-badge" id="platformBadge" title="YouTube">‚ñ∂Ô∏è</div>
                        </div>
                        <div class="video-info-sidebar">
                            <h2 id="videoTitle" class="video-title-sidebar">T√≠tulo del video</h2>
                            <p id="videoUploader" class="video-uploader-sidebar">Subido por</p>
                        </div>
                    </div>

                    <!-- Opciones de calidad y recorte -->
                    <div class="download-options-sidebar">
                        <div class="sidebar-section-title">Opciones de Descarga</div>

                        <!-- Selector de Calidad -->
                        <div id="qualityCard" class="option-card-sidebar">
                            <div class="option-header-sidebar">Calidad</div>
                            <select id="qualitySelector" class="quality-select-sidebar">
                                <!-- Opciones din√°micas -->
                            </select>
                        </div>

                        <!-- Selector de Formato (Video/Audio) -->
                        <div class="format-selector">
                            <button type="button" id="formatVideo" class="format-btn active" data-format="video">
                                <svg viewBox="0 0 24 24" fill="none" width="16" height="16">
                                    <rect x="2" y="4" width="20" height="16" rx="2" stroke="currentColor"
                                        stroke-width="2" />
                                    <path d="M10 9L15 12L10 15V9Z" fill="currentColor" />
                                </svg>
                                Video
                            </button>
                            <button type="button" id="formatAudio" class="format-btn" data-format="audio">
                                <svg viewBox="0 0 24 24" fill="none" width="16" height="16">
                                    <path d="M9 18V5L21 3V16" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                    <circle cx="6" cy="18" r="3" stroke="currentColor" stroke-width="2" />
                                    <circle cx="18" cy="16" r="3" stroke="currentColor" stroke-width="2" />
                                </svg>
                                Audio
                            </button>
                        </div>

                        <!-- Toggle de Recorte -->
                        <div class="toggles-sidebar">
                            <label class="toggle-option-sidebar">
                                <input type="checkbox" id="trimEnabled">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Recortar</span>
                            </label>
                        </div>

                        <!-- Input oculto para mantener compatibilidad -->
                        <input type="checkbox" id="audioToggle" class="hidden">

                        <!-- Timeline (solo visible si Trim activado) -->
                        <div id="timelineContainer" class="timeline-container-sidebar hidden">
                            <div class="timeline-inputs">
                                <span id="startTimeDisplay">00:00</span>
                                <span class="timeline-sep">-</span>
                                <span id="endTimeDisplay">00:00</span>
                            </div>
                            <div class="timeline-track" id="timelineTrack">
                                <div class="timeline-range" id="timelineRange"></div>
                                <div class="timeline-handle start" id="handleStart"></div>
                                <div class="timeline-handle end" id="handleEnd"></div>
                            </div>
                        </div>
                    </div>

                    <button id="addToQueueBtn" class="add-btn-sidebar interact-btn">
                        Actualizar Opciones
                    </button>
                    <button id="downloadBtn" class="download-btn-sidebar interact-btn primary hidden">
                        <span class="btn-content">Descargar</span>
                        <div class="btn-loader hidden"></div>
                    </button>
                </section>

                <section id="noSelectionState" class="no-selection-state">
                    <div class="no-selection-icon">üëà</div>
                    <p>Selecciona un video de la cola para ver sus opciones</p>
                </section>

            </div>
        </div>
    </main>

    <!-- Modal de Playlist -->
    <div id="playlistModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìã Playlist detectada</h3>
                <button class="modal-close" id="closePlaylistModal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="playlistInfo">Se encontraron <strong>0</strong> videos en esta playlist.</p>
                <div class="modal-options">
                    <button id="singleVideoBtn" class="modal-option-btn">
                        <svg viewBox="0 0 24 24" fill="none">
                            <rect x="2" y="4" width="20" height="16" rx="2" stroke="currentColor" stroke-width="2" />
                            <path d="M10 9L15 12L10 15V9Z" fill="currentColor" />
                        </svg>
                        <span>Solo este video</span>
                    </button>
                    <button id="addPlaylistBtn" class="modal-option-btn highlight">
                        <svg viewBox="0 0 24 24" fill="none">
                            <path d="M4 6H20M4 12H20M4 18H12" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                            <path d="M17 15V21M14 18H20" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                        <span>Agregar playlist a cola</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de √âxito -->
    <div id="successModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-success">
            <div class="modal-header">
                <h3>‚úÖ Descarga completada</h3>
                <button class="modal-close" id="closeSuccessModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="success-icon">
                    <svg viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                        <path d="M8 12L11 15L16 9" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </div>
                <p id="successFileName" class="success-filename">video.mp4</p>
                <p id="successFileSize" class="success-filesize">0 MB</p>
                <div class="success-actions">
                    <button id="openFileBtn" class="success-btn primary">
                        <svg viewBox="0 0 24 24" fill="none">
                            <path
                                d="M14 2H6C5.44772 2 5 2.44772 5 3V21C5 21.5523 5.44772 22 6 22H18C18.5523 22 19 21.5523 19 21V7L14 2Z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M14 2V7H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                        Abrir archivo
                    </button>
                    <button id="openFolderBtn" class="success-btn secondary">
                        <svg viewBox="0 0 24 24" fill="none">
                            <path
                                d="M22 19C22 20.1046 21.1046 21 20 21H4C2.89543 21 2 20.1046 2 19V5C2 3.89543 2.89543 3 4 3H9L11 6H20C21.1046 6 22 6.89543 22 8V19Z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        Abrir carpeta
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Error -->
    <div id="errorModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-error">
            <div class="modal-header">
                <h3>‚ùå Error en la descarga</h3>
                <button class="modal-close" id="closeErrorModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="error-icon">
                    <svg viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                        <path d="M15 9L9 15M9 9L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </div>
                <p id="errorMessage" class="error-text">No se pudo descargar el video.</p>
                <details class="error-details">
                    <summary>Ver detalles t√©cnicos</summary>
                    <pre id="errorDetails"></pre>
                </details>
                <button id="retryDownloadBtn" class="error-retry-btn">Reintentar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Historial -->
    <div id="historyModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-history">
            <div class="modal-header">
                <h3>
                    <svg viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                        <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                    Historial
                </h3>
                <div class="header-actions">
                    <button id="clearHistoryBtn" class="clear-history-icon-btn hidden" title="Limpiar historial">
                        <svg viewBox="0 0 24 24" fill="none">
                            <path
                                d="M19 7L18.1327 19.1425C18.0579 20.1891 17.187 21 16.1378 21H7.86224C6.81296 21 5.94208 20.1891 5.86732 19.1425L5 7M10 11V17M14 11V17M15 7V4C15 3.44772 14.5523 3 14 3H10C9.44772 3 9 3.44772 9 4V7M4 7H20"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </button>
                    <button class="modal-close" id="closeHistoryModal">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div id="historyList" class="history-list">
                    <!-- Items del historial se agregan din√°micamente -->
                </div>
                <div id="historyEmptyState" class="history-empty hidden">
                    <p>No hay descargas recientes</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>Hecho con <span class="heart">‚ô•</span> para descargas sin l√≠mites</p>
    </footer>

    <script src="app.js"></script>
    <script>
        // Handler para bot√≥n abrir carpeta de descargas
        document.getElementById('openFolderBtn')?.addEventListener('click', async () => {
            if (window.electronAPI && window.electronAPI.openPath) {
                // Intentar usar la ruta guardada en state (accedida via window)
                let pathToOpen = window.currentDownloadPath;

                // Si no hay ruta guardada, usar la ruta por defecto
                if (!pathToOpen) {
                    pathToOpen = await window.electronAPI.getDefaultDownloadPath();
                }

                if (pathToOpen) {
                    await window.electronAPI.openPath(pathToOpen);
                }
            }
        });
    </script>
</body>

</html>